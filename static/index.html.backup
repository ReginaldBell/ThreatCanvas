<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThreatCanvas - SSH Attack Visualization</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.Default.min.css" />
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #0a0e27; --bg-secondary: #151936; --bg-tertiary: #1e2347;
            --text-primary: #e0e6ed; --text-secondary: #8b92a9;
            --accent-primary: #00d4ff; --accent-danger: #ff4757;
            --accent-success: #2ed573; --accent-warning: #ffa502; --border-color: #2a3150;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-primary); color: var(--text-primary); overflow: hidden; }
        .dashboard-container { display: flex; height: 100vh; }
        .sidebar { width: 360px; background: var(--bg-secondary); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; overflow: hidden; transition: transform 0.3s ease; }
        .sidebar.collapsed { transform: translateX(-360px); }
        .sidebar-header { padding: 24px; border-bottom: 1px solid var(--border-color); }
        .sidebar-header h1 { font-size: 24px; font-weight: 700; margin-bottom: 8px; background: linear-gradient(135deg, var(--accent-primary) 0%, #0088ff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .sidebar-header p { color: var(--text-secondary); font-size: 13px; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 20px 24px; border-bottom: 1px solid var(--border-color); }
        .stat-card { background: var(--bg-tertiary); padding: 16px; border-radius: 8px; border: 1px solid var(--border-color); }
        .stat-value { font-size: 28px; font-weight: 700; margin-bottom: 4px; }
        .stat-label { font-size: 12px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }
        .controls-section { flex: 1; overflow-y: auto; padding: 24px; }
        .control-group { margin-bottom: 24px; }
        .control-group label { display: block; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; color: var(--text-secondary); }
        .button-group { display: flex; gap: 8px; flex-wrap: wrap; }
        .btn { padding: 10px 16px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary); border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s; white-space: nowrap; }
        .btn:hover { background: var(--bg-primary); border-color: var(--accent-primary); }
        .btn.active { background: var(--accent-primary); color: var(--bg-primary); border-color: var(--accent-primary); }
        .btn-primary { background: var(--accent-primary); color: var(--bg-primary); border-color: var(--accent-primary); font-weight: 600; }
        .btn-primary:hover { opacity: 0.9; }
        .search-input { width: 100%; padding: 10px 14px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary); font-size: 14px; }
        .search-input:focus { outline: none; border-color: var(--accent-primary); }
        .checkbox-group { display: flex; flex-direction: column; gap: 10px; }
        .checkbox-label { display: flex; align-items: center; cursor: pointer; padding: 8px; border-radius: 4px; transition: background 0.2s; }
        .checkbox-label:hover { background: var(--bg-tertiary); }
        .checkbox-label input { margin-right: 10px; width: 16px; height: 16px; }
        .top-attackers { max-height: 300px; overflow-y: auto; }
        .attacker-item { padding: 12px; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 6px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s; }
        .attacker-item:hover { background: var(--bg-primary); border-color: var(--accent-primary); }
        .attacker-ip { font-weight: 600; font-size: 14px; margin-bottom: 4px; }
        .attacker-meta { font-size: 12px; color: var(--text-secondary); }
        .attacker-count { color: var(--accent-danger); font-weight: 600; }
        .map-container { flex: 1; position: relative; }
        #map { width: 100%; height: 100%; }
        .map-controls { position: absolute; top: 20px; right: 20px; z-index: 1000; display: flex; gap: 10px; }
        .toggle-btn { padding: 12px 18px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); cursor: pointer; font-size: 13px; font-weight: 600; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); transition: all 0.2s; }
        .toggle-btn:hover { background: var(--bg-tertiary); }
        .toggle-btn.active { background: var(--accent-primary); color: var(--bg-primary); }
        .incident-drawer { position: absolute; bottom: 0; left: 0; right: 0; background: var(--bg-secondary); border-top: 1px solid var(--border-color); padding: 24px; max-height: 50%; overflow-y: auto; transform: translateY(100%); transition: transform 0.3s ease; z-index: 1000; }
        .incident-drawer.visible { transform: translateY(0); }
        .drawer-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .drawer-header h2 { font-size: 20px; }
        .close-drawer { background: transparent; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer; padding: 4px 8px; }
        .drawer-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; }
        .drawer-field { background: var(--bg-tertiary); padding: 16px; border-radius: 6px; border: 1px solid var(--border-color); }
        .drawer-field-label { font-size: 11px; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 6px; letter-spacing: 0.5px; }
        .drawer-field-value { font-size: 16px; font-weight: 600; }
        .timestamp-list { max-height: 150px; overflow-y: auto; font-size: 13px; color: var(--text-secondary); }
        .timestamp-list div { padding: 4px 0; }
        .loading-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(10, 14, 39, 0.9); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .loading-overlay.visible { display: flex; }
        .spinner { width: 50px; height: 50px; border: 4px solid var(--border-color); border-top-color: var(--accent-primary); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @media (max-width: 768px) { .sidebar { position: absolute; top: 0; left: 0; height: 100%; z-index: 1500; box-shadow: 4px 0 12px rgba(0, 0, 0, 0.5); } .stats-grid { grid-template-columns: 1fr; } .map-controls { top: 10px; right: 10px; } }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-secondary); }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>üõ°Ô∏è ThreatCanvas</h1>
                <p>Real-time SSH threat monitoring</p>
            </div>
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-value" id="statTotal">0</div><div class="stat-label">Total Incidents</div></div>
                <div class="stat-card"><div class="stat-value" id="statIPs">0</div><div class="stat-label">Unique IPs</div></div>
                <div class="stat-card"><div class="stat-value" id="statCountries">0</div><div class="stat-label">Countries</div></div>
                <div class="stat-card"><div class="stat-value" id="statFailed">0</div><div class="stat-label">Failed Logins</div></div>
            </div>
            <div class="controls-section">
                <div class="control-group">
                    <label>‚è±Ô∏è Timeframe</label>
                    <div class="button-group">
                        <button class="btn" data-time="1h">1 Hour</button>
                        <button class="btn active" data-time="24h">24 Hours</button>
                        <button class="btn" data-time="7d">7 Days</button>
                        <button class="btn" data-time="30d">30 Days</button>
                    </div>
                </div>
                <div class="control-group">
                    <label>üéØ Event Types</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" value="failed_login" checked><span>Failed Login Attempts</span></label>
                        <label class="checkbox-label"><input type="checkbox" value="accepted_login" checked><span>Successful Logins</span></label>
                        <label class="checkbox-label"><input type="checkbox" value="invalid_user" checked><span>Invalid User</span></label>
                        <label class="checkbox-label"><input type="checkbox" value="break_in_attempt" checked><span>Break-in Attempts</span></label>
                    </div>
                </div>
                <div class="control-group">
                    <label>üîç Search IP</label>
                    <input type="text" class="search-input" id="searchInput" placeholder="e.g., 192.168.1">
                </div>
                <div class="control-group">
                    <label>üîÑ Auto-Refresh</label>
                    <div class="button-group">
                        <button class="btn" id="toggleAutoRefresh">OFF</button>
                        <button class="btn btn-primary" id="refreshNow">Refresh Now</button>
                    </div>
                </div>
                <div class="control-group">
                    <label>üì• Export</label>
                    <div class="button-group">
                        <button class="btn" id="exportCSV">Download CSV</button>
                        <button class="btn" id="exportJSON">Download JSON</button>
                    </div>
                </div>
                <div class="control-group">
                    <label>üî• Top Attackers</label>
                    <div class="top-attackers" id="topAttackers"></div>
                </div>
            </div>
        </aside>
        <main class="map-container">
            <div class="map-controls">
                <button class="toggle-btn" id="toggleClusters">üéØ Clustering</button>
                <button class="toggle-btn" id="toggleHeatmap">üî• Heatmap</button>
                <button class="toggle-btn" id="toggleSidebar">‚ò∞ Menu</button>
            </div>
            <div id="map"></div>
            <div class="loading-overlay" id="loadingOverlay"><div class="spinner"></div></div>
            <div class="incident-drawer" id="incidentDrawer">
                <div class="drawer-header">
                    <h2>Incident Details</h2>
                    <button class="close-drawer" id="closeDrawer">‚úï</button>
                </div>
                <div class="drawer-content" id="drawerContent"></div>
            </div>
        </main>
    </div>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/leaflet.markercluster.min.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js"></script>
    <script src="js/api.js"></script>
    <script src="js/map.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
